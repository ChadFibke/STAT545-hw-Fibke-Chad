---
title: "HW05_THE_FINISHER"
author: "Chad Fibke"
date: '2017-10-11'
output: github_document
---

# 1.Installation of data set and data analysis packages 

```{r}
library(gapminder)
library(tidyverse)
library(forcats)

```
Just some quick notes:

+ Comments about my code will be within code chunks:
```{r}
# Like this 
```
+ Comments about my workflow will be outside of the code chunks. 
+ I will be working with the gapminder dataset!

# 2.Factor management 
Let's take a look at gapminder to see what variables are concidered factors:
```{r}
str(gapminder)
```

Now we know gapminder's variable:

+ Country is a factor and  has 142 different levels.

```{r Country.levels, echo=TRUE}
levels(gapminder$country) %>% 
  head() %>% 
  knitr::kable(col.names = "Country Factors")# I'm only showing few levels to help our poor eyes
```

+ Continent is a factor and has 5 different levels. 
```{r Continent.levels, echo=TRUE}
levels(gapminder$continent) %>% 
  knitr::kable( col.names = "Continent Factors")

```

We now know what factors we are working with, so see what we have to drop! We want to drop Ocieania, but lets see what we are actually dropping:

```{r}
 EX.Ocieania <- gapminder %>% 
  filter(continent == "Oceania") 
 

EX.Ocieania$country %>%   
   fct_drop() %>% 
  levels() 

EX.Ocieania$continent %>%   
   fct_drop() %>% 
  nlevels() 
```
The above shows that when we drop the Ocieania Continent: 

+ One level will be dropped for continents.
+ Two levels  will be dropped for countries.

Now we know how many we are dropping lets go in the revese direction and drop them:
```{r}
Without.Ocieania <- gapminder %>% 
  filter(continent != "Oceania")

Droped.Ocieania <- Without.Ocieania %>%   
   droplevels()# droplevels was used because it can be applied to a dataset, whereas fct_drop  is applied to a vector. 

Droped.Ocieania$country %>%
  nlevels()# As seen above we have ofically droped the "Australia" and "New Zealand" levels, leaving us with 140 country levels.

Droped.Ocieania$continent %>%
  levels()# As seen above we have ofically droped the Ocieania level, leaving us with only 4 remaining continent levels.

```

We now have the Droped.Ocieania dataset with factors that are of intrest. 

Let use this dataset to reorder the country factor based on the higest population size for the Americas:
```{r population.growth.wrong, echo=TRUE}
POP.Growth <- Droped.Ocieania %>%
  filter(continent == "Americas") %>% 
  select(continent, country, year, pop) %>%
  group_by(country) %>%
  mutate(maxPop = max(pop))# this is just cleaning up some data to calclate the mam population size per continent
 POP.Growth %>%  
 ggplot(aes(x = country, y = maxPop))+
  geom_point()+
    ggtitle(" Max Population size \n for countries within the Americas ")+
    theme(axis.text.x = element_text(angle = 90))

 
```

This graph makes our eyes work way to hard. Lets try reordering the factors based on max population size!

```{r population.growth.right, echo=TRUE}
 POP.Growth %>%  
 ggplot(aes(x = fct_reorder(country, maxPop), y = pop))+
  geom_boxplot()+
     theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Population size ditributions for the Americas ")+
  xlab("Countries")+
  ylab("Population Size")+
   geom_rect(aes(xmin = 12, xmax = 16, ymin = 1, ymax = 11^7), alpha = 0.0001, color = "red")# I choose box plots because their upper whiskers are sesnistive to large outlier (max population values)
```

I choose box plots because their upper whiskers are sesnistive to large outlier (max population values). The red box shows this ordering is specific to max population size and doesn't account for statistics like the median. 


# 3.Common part &File I/O 

Lets continue our adventure with the Droped.Ocieania dataset. From the above graphs we see that a lot of countries in the americas have similar distributions and take up a lot of unneccsary space. Lets now concider lumping these countries and then export and import the results.


We should be dealing with 140 country levels because we droped the Ocieania levels and only wrangled the data, but lets find out: 

```{r}
POP.Growth$country %>% 
  nlevels()
```
I'm now going to drop the other unused levels:

```{r}
THE.AMERICAS <- POP.Growth %>% 
  droplevels()

THE.AMERICAS$continent %>% 
  levels()

THE.AMERICAS$country %>% 
  levels()

```

lets order **AND** collapse the countries into factors that we care about:
```{r}
THE.AMERICAS<-ungroup(THE.AMERICAS)# We cannot reoder factors if the dataframe is grouped.

THE.AMERICAS <- THE.AMERICAS %>% 
  mutate(country = fct_reorder(country, maxPop))

            
Collapsed.Americas <- THE.AMERICAS %>% 
  mutate(country =fct_collapse (THE.AMERICAS$country, Non_interesting_Countries = c("Trinidad and Tobago", "Jamaica", "Panama", "Uruguay", "Puerto Rico", "Costa Rica", "Nicaragua", "Paraguay", "El Salvador", "Honduras", "Haiti", "Bolivia", "Dominican Republic", "Cuba", "Guatemala","Ecuador", "Chile", "Venezuela", "Peru", "Canada", "Argentina", "Colombia" ),
  Mexico ="Mexico",
  Brazil ="Brazil",
  USA = "United States")) %>% 
  droplevels()

Collapsed.Americas$country %>%
  levels()

 Collapsed.Americas %>% 
 ggplot(aes(x = fct_reorder(country, maxPop), y = pop))+
  geom_boxplot(aes(fill = country))+
   theme_classic()+
  ggtitle("Population size ditributions for the Americas ")+
  xlab("Countries")+
  ylab("Population Size")
```

Lets save, export then import to see if our factors are the way we left them:

```{r}
dput(Collapsed.Americas, "Collapsed.Americas-dput.txt")
```



```{r}
rm(Collapsed.Americas)
Collapsed.Americas_dget <- dget("Collapsed.Americas-dput.txt")
```


