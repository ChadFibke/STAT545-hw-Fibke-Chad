---
title: "HW05_THE_FINISHER"
author: "Chad Fibke"
date: '2017-10-11'
output: github_document
---

# 1.Installation of data set and data analysis packages 

```{r}
library(gapminder)
library(tidyverse)
library(forcats)
library(cowplot)

```
Just some quick notes:

+ Comments about my code will be within code chunks:
```{r}
# Like this 
```
+ Comments about my workflow will be outside of the code chunks. 
+ I will be working with the gapminder dataset!

# 2.Factor management 
Let's take a look at gapminder to see what variables are considered factors:
```{r}
str(gapminder)
```

Now we know gapminder's variable:

+ Country is a factor and  has 142 different levels.

```{r Country.levels, echo=TRUE}
levels(gapminder$country) %>% 
  head() %>% 
  knitr::kable(col.names = "Country Factors")# I'm only showing few levels to help our poor eyes
```

+ Continent is a factor and has 5 different levels. 
```{r Continent.levels, echo=TRUE}
levels(gapminder$continent) %>% 
  knitr::kable( col.names = "Continent Factors")

```
We now know what factors we are working with!

We want to drop Oceania, but lets see what we are actually dropping:

```{r}
 EX.Oceania <- gapminder %>% 
  filter(continent == "Oceania") 
 
EX.Oceania$country %>%   
   fct_drop() %>% 
  levels() 

EX.Oceania$continent %>%   
   fct_drop() %>% 
  nlevels() 
```
The above shows that when we drop the Oceania Continent: 

+ One level will be dropped from continents.
+ Two levels will be dropped from countries.

Now we know how many we are dropping...... so I'm now going to drop them:

```{r}
Without.Oceania <- gapminder %>% 
  filter(continent != "Oceania")

Dropped.Oceania  <- Without.Oceania %>%   
   droplevels()# droplevels was used because it can be applied to a dataset, whereas fct_drop  is applied to a vector. 

Dropped.Oceania$country %>%
  nlevels()# As seen above we have ofically droped the "Australia" and "New Zealand" levels, leaving us with 140 country levels.

Dropped.Oceania$continent %>%
  levels()# As seen above we have officially dropped the Oceania level, leaving us with only 4 remaining continent levels.

```

We have officially Dropped Oceania!


We can now wrangle this data so we can later focus on the concept of reordering:

```{r population.growth.wrong, echo=TRUE}
THE.AMERICAS <- Dropped.Oceania %>%
  filter(continent == "Americas") %>% 
  select(continent, country, year, pop) %>%
  group_by(country) %>%
  mutate(maxPop = max(pop)) %>% 
  droplevels() %>% 
  ungroup() 

Collapsed.Americas <- THE.AMERICAS %>% 
  mutate(country =fct_collapse (THE.AMERICAS$country, Non_interesting_Countries = c("Trinidad and Tobago", "Jamaica", "Panama", "Uruguay", "Puerto Rico", "Costa Rica", "Nicaragua", "Paraguay", "El Salvador", "Honduras", "Haiti", "Bolivia", "Dominican Republic", "Cuba", "Guatemala","Ecuador", "Chile", "Venezuela", "Peru", "Canada", "Argentina", "Colombia" ),
  Mexico ="Mexico",
  Brazil ="Brazil",
  USA = "United States")) %>% 
  droplevels()

THE.AMERICAS$continent %>% 
  levels()

THE.AMERICAS$country %>% 
  levels()

# this is just cleaning up some data to calculate the max population size in the Americas!
 


Original.plot<-Collapsed.Americas  %>%  
 ggplot(aes(x = country, y = maxPop))+
  geom_point()+
    ggtitle(" Max Population size \n for countries within the Americas ")+
  xlab("")+
    theme(axis.text.x = element_text(angle = 90))# I'm going to save this plot for later!

 
```
**make sure to use the new color format here**
What if we take the same data set and use arrange to move the countries around:


```{r}
POP.Growth.Arranged <-Collapsed.Americas %>% 
  arrange(maxPop) 

knitr::kable(head(POP.Growth.Arranged))
#This is jsut to show that the data is arranged properly!


Arranged.plot <- POP.Growth.Arranged %>% 
  ggplot(aes(x = country, y = maxPop))+
  geom_point()+
    ggtitle(" Max Population size \n for countries within the Americas ")+
  xlab("")+
    theme(axis.text.x = element_text(angle = 90))# I'm going to save this plot for later as well!
```

Now lets try to reorder using fctcat!
```{r}


Collapsed.Americas %>%
  mutate(country = fct_reorder(country, maxPop))# We cannot reoder factors if the dataframe is grouped.

reordered.plot<- Collapsed.Americas%>%  
 ggplot(aes(x = country, y = pop))+
  geom_boxplot()+
     theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Population size ditributions for the Americas ")+
  xlab("")+
  ylab("Population Size")+
   geom_rect(aes(xmin = 12, xmax = 16, ymin = 1, ymax = 11^7), alpha = 0.0001, color = "red")
```

And lets try to throw of the reordered data with arrnging the data in decending order

```{r}
Mixed<- Collapsed.Americas %>% 
  arrange(desc(maxPop)) 

Mixed%>%
  head() %>% 
  knitr::kable()
#This is jsut to show that the data is arranged properly!
  
  
  Mix.plot <- Mixed %>% 
  ggplot(aes(x = country, y = maxPop))+
  geom_point()+
    ggtitle(" Max Population size \n for countries within the Americas ")+
  xlab("")+
    theme(axis.text.x = element_text(angle = 90))
  
  


```
I know you are probaly freaking out that I'm not showing any graphs! (I' kinda scared to see what happens to), but I was waiting to do this:

```{r}
Original.plot
Arranged.plot
reordered.plot
Mix.plot

plot_grid(Original.plot, Arranged.plot, reordered.plot, Mix.plot,
          labels = c("A", "B", "C", "D"),
          ncol = 2,
          align = "h")


```




I chose box plots because their upper whiskers are sensitive to large outlier (max population values). The red box shows this ordering is specific to the max observation **and** ignors medians.

# 3.Common part &File I/O 

Lets continue our adventure with the POP.GROWTH dataset by playing around with arrange and fct_reorder:









From the above graphs we see that a lot of countries in the Americas have similar distributions and take up a lot of unnecessary space. Lets now consider lumping these countries and then export and import the results.


Lets collapse **AND** reorder the countries into factors that we care about:
```{r}


            
Collapsed.Americas <- THE.AMERICAS %>% 
  mutate(country =fct_collapse (THE.AMERICAS$country, Non_interesting_Countries = c("Trinidad and Tobago", "Jamaica", "Panama", "Uruguay", "Puerto Rico", "Costa Rica", "Nicaragua", "Paraguay", "El Salvador", "Honduras", "Haiti", "Bolivia", "Dominican Republic", "Cuba", "Guatemala","Ecuador", "Chile", "Venezuela", "Peru", "Canada", "Argentina", "Colombia" ),
  Mexico ="Mexico",
  Brazil ="Brazil",
  USA = "United States")) %>% 
  droplevels()

Collapsed.Americas$country %>%
  levels()

 Collapsed.Americas %>% 
 ggplot(aes(x = country, y = pop))+  # I already re-ordered above!
  geom_boxplot(aes(fill = country))+
   theme_classic()+
  ggtitle("Population size ditributions for the Americas ")+
  xlab("Countries")+
  ylab("Population Size")
```

We have finished some analysis for the day and decide the save our data. 


```{r}
write_csv(Collapsed.Americas, "Collapsed.Americas.csv")
```


Boom, saved! We no longer have to worry about losing our data! (I cannot remove this dataset because Knitr has given me an error say that this object doesnt exist when I use it in later code)


I'm now going to load this Csv file and see if our factors are still safe:
```{r}
Collapsed.Americas.CSV <- read_csv("Collapsed.Americas.csv")

head(Collapsed.Americas.CSV)

```
#wait a second..... all my factor variables are seen as charactor variables. Let me fix that and continue so see if my variables are still ordered:

```{r}
Collapsed.Americas.CSV %>% 
  mutate(country = factor(country), continent = factor(continent))

 Collapsed.Americas.CSV %>%  
 ggplot(aes(x =country, y = pop))+
  geom_boxplot()+
   theme_classic()+
  ggtitle("Population size ditributions for the Americas ")+
  xlab("Countries")+
  ylab("Population Size")

```
For pet sakes all that hard work ordering these factors and now I have to repeate the prosess all over?!?!


OR we can import/export using dput/dget instead!
```{r}
dput(Collapsed.Americas, "Collapsed.Americas-dput.txt")

Collapsed.Americas_dget <- dget("Collapsed.Americas-dput.txt") 


Collapsed.Americas_dget

   
Collapsed.Americas_dget %>% 
  ggplot(aes(x =country, y = pop))+
  geom_boxplot()+
   theme_classic()+
  ggtitle("Population size ditributions for the Americas ")+
  xlab("Countries")+
  ylab("Population Size")


```

The above plot shows:

+ The factor order based of max population size was kept!
+ The factor names were kept!





